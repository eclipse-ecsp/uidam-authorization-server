# This file is loaded and OVERRIDES main application.properties for tests
# Override spring.config.import to remove configserver: which causes test failures
spring.config.import=optional:classpath:tenant-ecsp.properties,optional:classpath:tenant-sdp.properties

# Disable Spring Cloud Config Server
spring.cloud.config.enabled=false

# Properties needed by beans (from main application.properties)
server.servlet.session.timeout=5m
user.session.force.login=true
session.recreation.policy=IF_REQUIRED

# CORS configuration for tests
cors.allowed.origin.patterns=*.harmandev.com,*.harman.com
cors.allowed.methods=GET,HEAD,POST

# Cache configuration for tests
cache.expire.mins=60
cache.max.size=100
cache.client.ids=token-mgmt,device-mgmt

# Liquibase configuration for tests
uidam.liquibase.change-log.path=classpath:database.schema/master.xml
uidam.default.db.schema=uidam

# OAuth2 issuer configuration for tests
ignite.oauth2.issuer.protocol=http
ignite.oauth2.issuer.host=localhost
ignite.oauth2.issuer.prefix=

# OAuth2 token hash configuration for tests
uidam.oauth2.token.hash.algorithm=SHA-256
uidam.oauth2.token.hash.salt=ChangeMe

# Cleanup job configuration for tests
cleanup.job.batch.size=50000
cleanup.job.scheduling.rate.cron=0 0 */6 * * *
cleanup.job.scheduling.retry.attempts=3
cleanup.token.expires.before=1

# PostgreSQL configuration for tests
postgres.jdbc.url=jdbc:postgresql://localhost:5432/uidam_management_test
postgres.username=test_user
postgres.password=test_password
postgres.driver.class.name=org.postgresql.Driver
postgres.pool.name=hikariConnectionPool
postgres.data-source-properties.cachePrepStmts=true
postgres.data-source-properties.prepStmtCacheSize=250
postgres.data-source-properties.prepStmtCacheSqlLimit=2048
postgres.max.idle.time=0
postgres.min.pool.size=15
postgres.max.pool.size=30
postgres.connection.timeout.ms=60000
postgres.expected99thPercentileMs=60000
postgres.datasource.create.retry.count=3
postgres.datasource.retry.delay.ms=30
postgresdb.metrics.enabled=false
postgresdb.metrics.executor.shutdown.buffer.ms=2000
postgresdb.metrics.thread.freq.ms=5000
postgresdb.metrics.thread.initial.delay.ms=2000

# Additional properties for tests
user.management.base.url=http://localhost:8081
security.client.bcrypt.strength=high
ignite.oauth2.jks-enabled=true
metrics.prometheus.enabled=false
prometheus.agent.port=9100
prometheus.agent.port.exposed=9100
service.name=uidam-authorization-server
sp.restart.on.failure=false
